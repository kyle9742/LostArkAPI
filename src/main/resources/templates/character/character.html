<!doctype html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic.html}">
<head>
    <title>LostArkAPI</title>
</head>

<div layout:fragment="backgroundImage">

</div>
<div layout:fragment="content">
    <div class="container">
        <div class="d-flex justify-content-center align-items-center text-white">
            <div class="profile align-items-center card bg-dark col-5 text-white mx-auto my-5" style="height: 500px">

            </div>
            <div class="characterStat align-items-center card bg-dark col-3 text-white mx-auto" style="height: 500px">

            </div>
            <div class="engravings card bg-dark col-3 text-white mx-auto" style="height: 500px">

            </div>
        </div>
        <div class="d-flex justify-content-center align-items-center text-white">
            <div class="equipment card bg-dark align-items-center col-5 text-white mx-auto my-3" style="height: 700px">

            </div>
            <div class="accessory card bg-dark align-items-center col-3 text-white mx-auto my-3" style="height: 700px">

            </div>
            <div class="gems card bg-dark align-items-center col-3 text-white mx-auto my-3" style="height: 700px">

            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script th:src="@{/js/Character.js}"></script>
</div>

<script layout:fragment="script" th:inline="javascript">
    let characterName = new URL(location.href).pathname.substring(11);
    let profileDiv = document.querySelector('.profile');
    let characterStatDiv = document.querySelector('.characterStat');
    let engravingsDiv = document.querySelector('.engravings');
    let equipmentDiv = document.querySelector('.equipment');
    let accessoryDiv = document.querySelector('.accessory')
    let gemsDiv = document.querySelector('.gems');


    function printCharacter(characterName) {
        let profileStr = '';
        let characterStatStr = '';
        let effectStr = '';
        let equipmentStr = '';
        let accessoryStr = '';
        let gemsStr = '';

        getCharacter(characterName).then(data => {

            tempTitle = data.ArmoryProfile.Title;
            tempTownName = data.ArmoryProfile.TownName;
            tempGuildName = data.ArmoryProfile.GuildName;

            if (tempTitle === null) {
                tempTitle = "없 음";
            }

            if (tempTownName === null) {
                tempTownName = "없 음";
            }

            if (tempGuildName === null) {
                tempGuildName = "없 음"
            }

            profileStr += `<div class="card-body col d-flex justify-content-between align-items-center">
                                <div class="w-50">
                                    <p class="ellipsis"><strong>서 버 : </strong>${data.ArmoryProfile.ServerName}</p>
                                    <p class="ellipsis"><strong>길 드 : </strong>${tempGuildName}</p>
                                    <p class="ellipsis"><strong>클래스 : </strong>${data.ArmoryProfile.CharacterClassName}</p>
                                    <p class="ellipsis"><strong>칭 호 : </strong>${tempTitle}</p>
                                    <p class="ellipsis"><strong>전 투 : </strong>${data.ArmoryProfile.CharacterLevel}</p>
                                    <p class="ellipsis"><strong>아이템 : </strong>${data.ArmoryProfile.ItemMaxLevel}</p>
                                    <p class="ellipsis"><strong>원정대 : </strong>${data.ArmoryProfile.ExpeditionLevel}</p>
                                    <p class="ellipsis"><strong>P V P : </strong>${data.ArmoryProfile.PvpGradeName}</p>
                                    <p class="ellipsis"><strong>영 지 : </strong>${tempTownName}</p>
                                </div>
                                <div class="w-50">
                                    <img src="${data.ArmoryProfile.CharacterImage}" class="img img-fluid border rounded-3" alt="사진정보 없음">
                                    <div class="my-3">`

            for (tendency of data.ArmoryProfile.Tendencies) {
                profileStr += `<p class="ellipsis"><string>${tendency.Type} : </strong>${tendency.Point} / ${tendency.MaxPoint}</p>`
            }

            profileStr += `     </div>
                           </div>`

            characterStatStr += `<div class="card-body my-3 align-items-center">`

            for (const stat of data.ArmoryProfile.Stats) {
                characterStatStr += `<p class="ellipsis">${stat.Type} : ${stat.Value}</p>`
            }

            characterStatStr += `</div>`

            profileDiv.innerHTML += profileStr;
            characterStatDiv.innerHTML += characterStatStr;

            if (data.ArmoryEngraving.ArkPassiveEffects === null) {
                for (effect of data.ArmoryEngraving.Effects) {
                    effectStr += `<div class="d-flex justify-content-between mx-2 my-2 align-items-center">
                                    <p class="ellipsis">${effect.Name}</p><img src="${effect.Icon}" class="img-fluid rounded-circle w-25">
                                  </div>`
                }
            } else {
                for (arkpassiveEffect of data.ArmoryEngraving.ArkPassiveEffects) {
                    effectStr += `<div class="d-flex justify-content-between mx-2 my-2 align-items-center">
                                    <p class="ellipsis">${arkpassiveEffect.Name}</p>
                                  </div>`
                }
            }

            engravingsDiv.innerHTML += effectStr;

            equipmentStr += `<div class="text-white mx-2">
                             <div class="d-flex mx-2 my-2 bg-dark">
                             <div class="w-50">`

            for (let i = 0; i < 6; i++) {
                equipmentStr += `<p class="ellipsis"><img src="${data.ArmoryEquipment[i].Icon}" class="border rounded mx-3" style="width: 50px; height: 50px">(${data.ArmoryEquipment[i].Grade}) ${data.ArmoryEquipment[i].Name}</p>`
            }

            equipmentStr += `</div>`

            equipmentDiv.innerHTML += equipmentStr;

            for (let i = 6; i < data.ArmoryEquipment.length; i++) {
                accessoryStr += `<p class="ellipsis"><img src="${data.ArmoryEquipment[i].Icon}" class="border rounded mx-3" style="width: 50px; height: 50px">(${data.ArmoryEquipment[i].Grade}) ${data.ArmoryEquipment[i].Name}</p>`
            }

            accessoryDiv.innerHTML += accessoryStr;

            gemsStr += `<div class="card bg-dark text-white mx-2">`

            for (gemsData of data.ArmoryGem.Gems) {
                gemsStr += `<img src="${gemsData.Icon}" class="border rounded mx-3" style="width: 50px; height: 50px">`
            }

            gemsStr += `</div>`

            gemsDiv.innerHTML += gemsStr;
        });

        function printCharacterAvatars(characterName) {

            getCharacterAvatars(characterName).then(data => {

            });
        }

        function printCharacterCombatskills(characterName) {

            getCharacterCombatskills(characterName).then(data => {

            });
        }

        function printCharacterCards(characterName) {

            getCharacterCards(characterName).then(data => {

            });
        }

        function printCharacterGems(characterName) {

            getCharacterGems(characterName).then(data => {

            });
        }

        function printCharacterColosseums(characterName) {

            getCharacterColosseums(characterName).then(data => {

            });
        }

        function printCharacterCollectibles(characterName) {

            getCharacterCollectibles(characterName).then(data => {

            });
        }
    }

    printCharacter(characterName);

</script>

</html>